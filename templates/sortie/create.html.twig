{% extends 'base.html.twig' %}

{% block title %}Créer une sortie{% endblock %}

{% block stylesheets %}
    <script src="{{ asset('js/scripts.js') }}"></script>
{% endblock %}

{% block body %}

    {% if app.request.attributes.get('_route') == 'sortie_create' %}
        <h2 class="d-flex justify-content-center">Créer une sortie</h2>
    {% else %}
        <h2 class="d-flex justify-content-center">Modifiez une sortie</h2>
    {% endif %}

    <!-- affichage des messages d'erreur et de confirmation -->
    {% for group, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ group }}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    {{ form_start(formSortie) }}

    <div class="mb-3">
        {{ form_label(formSortie.nom) }}
        {{ form_widget(formSortie.nom) }}
        {{ form_errors(formSortie.nom) }}
    </div>

    <div class="mb-3">
        {{ form_label(formSortie.dateHeureDebut) }}
        {{ form_widget(formSortie.dateHeureDebut) }}
        {{ form_errors(formSortie.dateHeureDebut) }}
    </div>

    <div class="mb-3">
        {{ form_label(formSortie.duree) }}
        {{ form_widget(formSortie.duree) }}
        {{ form_errors(formSortie.duree) }}
    </div>

    <div class="mb-3">
        {{ form_label(formSortie.dateLimiteInscription) }}
        {{ form_widget(formSortie.dateLimiteInscription) }}
        {{ form_errors(formSortie.dateLimiteInscription) }}
    </div>

    <div class="mb-3">
        {{ form_label(formSortie.infosSortie) }}
        {{ form_widget(formSortie.infosSortie) }}
        {{ form_errors(formSortie.infosSortie) }}
    </div>

    <div class="mb-3">
        {{ form_label(formSortie.nbParticipantsMax) }}
        {{ form_widget(formSortie.nbParticipantsMax) }}
        {{ form_errors(formSortie.nbParticipantsMax) }}
    </div>

    <div class="mb-3">
        {{ form_label(formSortie.campus) }}
        {{ form_widget(formSortie.campus) }}
        {{ form_errors(formSortie.campus) }}
    </div>

    <div class="mb-3">
        {{ form_label(formSortie.ville) }}
{#        <a href="{{ path('lieu_afficher_ville', {'id': 'x'}) }}" class="villeChoisie" >#}
            {{ form_widget(formSortie.ville, {'attr': {'id': 'ville'}}) }}
{#        </a>#}
        {{ form_errors(formSortie.ville) }}
    </div>

    <div class="mb-3">
        {{ form_label(formSortie.lieu) }}
        {{ form_widget(formSortie.lieu) }}
        {{ form_errors(formSortie.lieu) }}
    </div>

    <!-- formulaire ajouter un lieu // méthode avec js mais ne fonctionne pas -->
    {# <button class="btn-info" type="button" name="ajoutLieu" id="btnAjoutLieu">Ajouter un lieu</button> #}

    {# <div id="ajoutFormLieu" class="cache"> #}
    {# {{ form(formLieu) }} #}
    {# </div> #}


    <!-- ajouter un lieu en formulaire imbriqué / méthode M. Racine mais pas adapté-->
    {# <div class="mb-3" style="text-align: right;"> #}
    {# <div class="col-xs-4"> #}
    {# {{ form_row(formLieu.nom) }} #}
    {# {{ form_row(formLieu.ville) }} #}
    {# {{ form_row(formLieu.rue) }} #}
    {# {{ form_row(formLieu.longitude) }} #}
    {# {{ form_row(formLieu.latitude) }} #}
    {# <a href="#" style="width:100%;" class="js-wishes-remove btn-danger btn">Remove Wish</a><hr/> #}
    {# </div> #}
    {# <a href="#" class="js-wishes-add btn-secondary btn">Ajouter un lieu</a> #}
    {# </div> #}
    {# </div> #}

    <div class="mb-3 cache">
        {{ form_label(formSortie.motifAnnulation) }}
        {{ form_widget(formSortie.motifAnnulation) }}
        {{ form_errors(formSortie.motifAnnulation) }}
    </div>

    <!-- bouton submit -->
    <div class="mb-3 d-flex justify-content-center">
        {{ form_widget(formSortie.submit) }}
    </div>

    {{ form_end(formSortie) }}

    <div class="mb-3 d-flex justify-content-center">
    <!-- Ajouter un lieu -->
    <a href="{{ path('lieu_create') }}">
        <button id="btnAjoutLieu" name='lieu' value='lieu' class='btn btn-secondary'>Créer un lieu</button>
    </a>
    </div>

    <!-- Si on arrive par la route modifier-->
    <!-- Publier -->
    <div class="mb-3 d-flex justify-content-center">
    {% if app.request.attributes.get('_route') == 'sortie_modifier' %}
        <a href="{{ url('sortie_publier', { "id": id }) }}">
            <button name='publier' value='publier' class='btn btn-primary'>Publier</button>
        </a>
        <!-- Annuler -->
        <a href="{{ url('sortie_motifannulation', { "id": id }) }}">
            <button id="btnAnnulerSortie" name='annuler' value='annuler' class='btn btn-danger'>Annuler</button>
        </a>
    {% endif %}

    <a class="navbar-brand" href="{{ url('main_home') }}">
        <button value='annuler' class='btn btn-info'>Retour accueil</button>
    </a>
    </div>

{% endblock %}


{% block javascripts %}

{#    <script>#}
{#        $(document).ready(function () {#}
{#            $(".btn-info").click(function () {#}
{#                $(".cache").toggleClass("clique");#}
{#            });#}
{#        });#}
{#    </script>#}

    <!-- js lié au formulaire imbriqué -->
    {# <script> #}
    {# jQuery(document).ready(function() { #}
    {# let $wrapper = $('.js-lieu-wrapper'); #}
    {# $wrapper.on('click', '.js-lieu-add', function(e) { #}
    {# e.preventDefault(); #}
    {# let prototype = $wrapper.data('prototype'); #}
    {# let index = $wrapper.data('index'); #}
    {# let newForm = ((index === 0) ? '<hr/>' : '') + prototype.replace(/__name__/g, index) + '<a href="#" style="width:100%;" class="js-lieu-remove btn-danger btn">Remove Wish</a><hr/>'; #}
    {# newForm += '<span class="mb-3 mt-3"></span>'; #}
    {# $wrapper.data('index', index + 1); #}
    {# $(this).before(newForm); #}
    {# }); #}
    {# $wrapper.on('click', '.js-lieu-remove', function(e) { #}
    {# alert("A vous de jouer !"); #}
    {# }); #}
    {# }); #}
    {# </script> #}

{#    Ajax pour lier la liste des lieux au choix de la ville#}
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>

            function onChangeAfficherLieux(event) {
                event.preventDefault();
                var ville = document.getElementById('ville') ;
                // var valeurselectionnee = ville.value;
                // var textselectionne = ville.text;
                // console.log(ville) ;
                // console.log(textselectionne) ;

                axios.get('/lieu/afficher/' + document.getElementById('ville').valueOf('id')).then(function (response) {
                    console.log(response.data);
                    // links.textContent = response.data.choix ;
                    // nbInscrits.textContent = '';
                    // nbInscrits.textContent = response.data.nbInscrits + ' / ' + response.data.nbPlaces ;
                    // inscr.textContent = response.data.inscrit;
                })
            }


            document.querySelectorAll('.form-select').forEach(function (link) {
                link.addEventListener('change', onChangeAfficherLieux);
                // alert('écouteur ok');
            });

        </script>

{% endblock javascripts %}
